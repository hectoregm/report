\chapter{Diseño e implementación del sistema PEAT}

Para lograr los objetivos del sistema \texttt{PEAT} se dividió en cuatro
componentes principales:

\begin{itemize}
\item Perfil sencillo del edificio (\textit{Simple Building Profile}): este
  componente realiza la configuración inicial del edificio, realizando solamente
  un numero limitado de preguntas básicas para definir las características básicas
  del edificio.
\item Perfil detallado del edificio (\textit{Detailed Building Profile}):
  este componente se encarga del manejo de las características básicas, detalladas y
  opcionales de un edificio.
\item Recomendaciones (\textit{Recommendations}): este componente genera una lista
  de medidas de ahorro de energía considerando la información ingresada al sistema
  hasta el momento. Aparte debe permitir al usuario obtener información detallada
  sobre las recomendaciones dadas y finalmente debe permitir indicar que el usuario
  se compromete a llevar acabo una recomendación.
\item Plan de ahorro de energía (\textit{Energy Savings Plan}): este componente
  presenta el consumo de energía del edificio al usuario, también presenta las
  recomendaciones que el usuario se ha comprometido a poner en acción.
\end{itemize}

Como se puede ver el modelo de edificio es el principal modelo dentro de
\texttt{PEAT}, por lo que obtener una correcta correspondencia entre un
edificio y su consumo energético es de vital importancia para dar la
información y recomendaciones mas útiles y fidedignas al usuario.

\section{Modelo de información}

El objetivo principal del modelo de información de \texttt{PEAT} es definir el
modelo de edificio y su relación con el consumo energético del usuario. Así
tenemos el concepto de edificio el cual es una estructura independiente a la
cual se le esta proporcionando un servicio ya sea electricidad o gas.

\subsection{Estructura de facturación de PG\&E}
Para obtener esta correspondencia entre edificio-consumo es necesario
tener en cuenta la estructura de facturación usada por PG\&E puesto
que de esta estructura es que se obtiene el consumo de electricidad y gas.

El usuario, la cuenta y el contrato de servicio representan el lado demográfico
del modelo de información, la cual cambia bastante:

\begin{itemize}
\item Usuario: representa al cliente. Tiene una o más cuentas.
\item Cuenta: representa la contabilidad financiera del usuario. Tiene uno o más
  contratos de servicio, uno por tipo de servicio (electricidad o gas), también
  tiene una o más direcciones de servicio asociadas.
\item Contrato de servicio: representa los servicios que el cliente adquiere
  de PG\&E, como la electricidad o el gas, puede tener uno o más puntos
  de servicio asociados.
\end{itemize}

La dirección de servicio, el punto de servicio y el medidor representan
la parte geográfica del modelo de información, esta información raramente cambia:

\begin{itemize}
\item Dirección de servicio: es una ubicación física en donde se prestan los
  servicios, en \texttt{PEAT} son el modelo que se quiere asociar al modelo
  de edificio para obtener el consumo del edificio, puede tener uno o más puntos
  de servicio.
\item Punto de servicio: es una coordenada geográfica en donde se conectan los
  servicios, puede tener uno o más medidores asociados.
\item Medidor: es un dispositivo instalado en un punto de servicio que registra el
  consumo del servicio proporcionado.
\end{itemize}

La relación entre todos estos modelos se puede ver en la Figura 3.1.

\jcimage{1.0}{imagenes/PGE-facturacion.png}{Modelos principales para la facturación
  en PG\&E.}

\subsection{Relación Edificio-Facturación}

Para que \texttt{PEAT} pueda cumplir sus requerimientos funcionales es necesario
definir claramente la relación entre un edificio y su consumo energético medido
por uno o varios medidores.
Aunque los medidores son los que tienen la información de consumo el relacionar
directamente un medidor con un edificio no es amigable para el usuario, porque
aunque el usuario generalmente conoce el numero de medidores que tiene no conoce
los identificadores para cada uno de estos.

Por lo que para facilitar la creación del perfil de un edificio se pide al usuario
que haga la correspondencia entre las direcciones de servicio asociadas a su cuenta
y el perfil de edificio que se esta creando.
El usuario al dar esta correspondencia permite al sistema obtener de forma
automatizada los puntos de servicio y sus medidores asociados al edificio y así
obtener su consumo energético real.

\section{Casos de uso}

\subsection{Diagrama general}

En la Figura 3.2 se muestra el diagrama general de casos de uso del sistema
\texttt{PEAT}. Se tienen diez casos de uso en total siendo siete casos para
\texttt{PEAT} y tres casos para la biblioteca \texttt{Bezel}.

Los casos de uso se agrupan en los cuatro componentes principales de la
siguiente manera:

\begin{itemize}
\item Perfil sencillo del edificio (\textit{Simple Building Profile}): Tiene
  solo el caso de uso \textit{Crear perfil del edificio} pero este caso de uso
  es uno de los mas complejos en cuestión de interacción con el usuario y su
  importancia para obtener las características básicas del edificio.
\item Perfil detallado del edificio (\textit{Detailed Building Profile}): Contiene
  los casos de uso \textit{Administrar perfil del edificio} y
  \textit{Obtener información del edificio} los cuales se encargan de la
  administración y obtención de información sobre el edificio.
\item Recomendaciones (\textit{Recommendations}): Contiene los casos de uso
  \textit{Administrar recomendaciones} y \textit{Ver recomendación}.
\item Plan de ahorro de energía (\textit{Energy Savings Plan}): Contiene los
  casos de uso \textit{Ver historial de consumo} y \textit{Administrar plan de
    ahorro}
  que se enfocan a la visualización del consumo eléctrico del usuario y las
  posibles recomendaciones para disminuir su consumo.
\end{itemize}

\jcimageinline{1.0}{imagenes/Diagrama-General-CasosDeUso.png}{Diagrama general de
  casos de uso de \texttt{PEAT}.}

\subsection{Crear perfil del edificio}

Para crear el perfil inicial de un edificio es necesario obtener las siguientes
características:

\begin{itemize}
\item La industria que mejor describe el negocio del usuario.
\item El tamaño del edificio (área).
\item El tipo de edificio.
\item La(s) dirección(es) de servicio asociada(s) al edificio.
\end{itemize}

Todas estas características se consideran básicas, es decir vitales para el
funcionamiento del sistema por lo todas son requeridas para construir el perfil
del edificio.

En este caso de uso también se obtiene la relación entre el edificio y su consumo
a partir de las direcciones de servicio que el usuario asocie al perfil.

El caso de uso esta diseñado de forma que el proceso sea realizado solamente
una vez por edificio. Las características básicas se mantienen accesibles por
medio del perfil detallado del edificio.

\begin{usecase}
  \addtitle{Caso de Uso:}{Crear perfil del edificio.}
  \addfield{Descripción:}{Un usuario PyME entra al sistema  para crear un perfil
    inicial de un edificio, respondiendo ciertas preguntas básicas sobre el
    edificio.}
  \addfield{Actor:}{Usuario PyME}
  \additemizedfield{Precondiciones:}{
  \item El usuario a sido autentificado por medio de un token de autenticación
    (\textit{Single Sign On} SSO) asignado por el sistema de PG\&E.
  \item Los datos de intervalo y de facturación del usuario están en el sistema.
  }
  \additemizedfield{Requerimientos no funcionales:}{
  \item El usuario debe ser capaz de completar el perfil del edificio en 20 segundos
    o menos.
  }
  \addscenario{Flujo normal:}{
  \item El sistema checa si el usuario tiene mas de una cuenta.
    \begin{enumerate}
    \item Si hay mas de una cuenta el sistema despliega una lista
      de cuentas, y el sistema requiere que el usuario elija una cuenta.
    \end{enumerate}
  \item El sistema despliega información sobre la cuenta: numero de cuenta y
    direcciones de servicio asociadas.
    \begin{enumerate}
    \item Si la cuenta tiene mas de una dirección de servicio
      el sistema requiere que el usuario elija por lo menos una dirección
      de servicio.
    \end{enumerate}
  \item El usuario selecciona las direcciones de servicio que apliquen
    al edificio.
  \item El usuario puede proporcionar un apodo para el edificio.
  \item El usuario debe indicar la industria que mejor describe su negocio.
  \item El usuario debe ingresar la siguiente información sobre el edificio:
    \begin{enumerate}
    \item Tipo.
    \item Rango de tamaño.
    \item Antigüedad.
    \end{enumerate}
  \item El usuario puede enviar los datos ingresados o cancelar.
  \item El usuario puede añadir otro edificio o si ya tiene al menos un
    perfil de edificio asociado puede proceder al plan de ahorro.
  }
  \addfield{Postcondiciones:}{
    Se genera un identificador único para el perfil del edificio generado, el cual
    esta asociado a los datos de facturación de la cuenta seleccionada por el
    usuario PyME.
  }
\end{usecase}

% FIXME: Insertar diagrama del modelo de información inducido por la creación
% de un perfil

\subsection{Administrar perfil del edificio}

Para el sistema \texttt{PEAT} se tiene las siguientes características:
\begin{itemize}
\item Básicas: son las características básicas de un edificio: tipo, tamaño y
  antigüedad, son vitales para el funcionamiento del sistema.
\item Detalladas: son las características mas significativas y fáciles de
  responder, ejemplos son: horas de operación, numero de empleados, numero
  de pisos, etcétera.
\item Opcionales: son características más avanzadas/técnicas sobre el equipo
  y estructura de un edificio.
\end{itemize}

Las características básicas son definidas al crear el perfil inicial de un
edificio como se documenta en el caso de uso anterior. Las características
detalladas y opcionales son definidas por medio de dos rutas:

\begin{itemize}
\item Por medio del perfil detallado del edificio, en la que se despliega
  las preguntas y respuestas sobre las características del edificio.
  Esta ruta es documentada en este caso de uso.
\item Un componente que es embebido en varias partes del sistema
  que realiza una sola pregunta al usuario para ir obteniendo progresivamente
  mas información sobre el edificio. Este componente tiene el nombre
  de Componente de Ingreso Progresivo (\textit{Progressive Profile Widget} PPW).
  Esta ruta es documentada en el caso de uso \textit{Obtener información
    del edificio}
\end{itemize}

\begin{usecase}
  \addtitle{Caso de Uso:}{Administrar perfil del edificio.}
  \addfield{Descripción:}{
    El usuario tiene acceso al perfil completo del edificio, es decir
    a todas las preguntas y respuestas asociadas a las características
    básicas, detalladas y opcionales de un edificio.}
  \addfield{Actor:}{Usuario PyME}
  \additemizedfield{Precondiciones:}{
  \item El usuario a sido autentificado por medio de un token de autenticación
    (\textit{Single Sign On} SSO) asignado por el sistema de PG\&E.
  \item El usuario a creado previamente el perfil básico del edificio.
  }
  \additemizedfield{Requerimientos no funcionales:}{
  \item Todas las acciones realizadas por el usuario deben ser procesadas
    en menos de un segundo.
  }
  \addscenario{Flujo normal:}{
  \item El sistema checa si la cuenta tiene mas de un edificio asociado.
    \begin{itemize}
    \item Si hay mas de un edificio asociado a la cuenta el usuario
      tiene que seleccionar el edificio correspondiente.
    \end{itemize}
  \item El sistema despliega una lista de preguntas y respuestas divida en secciones.
    Las secciones completadas están marcadas con una marca de completado.
    \begin{itemize}
    \item Las secciones que se despliegan dependen del tipo de edificio,
      por ejemplo: construcción, iluminación, calefacción y refrigeración.
    \item El usuario puede ver y actualizar sus respuestas a todas las
      preguntas en una sola pantalla.
    \end{itemize}
  \item El usuario selecciona una sección, esta se expande para mostrar todas
    las preguntas de la sección.
  \item El usuario responde una o varias preguntas.
    \begin{enumerate}
    \item Las preguntas son ordenadas dentro de cada sección según un orden
      predefinido. Las secciones también tienen un orden predefinido.
    \item Según vaya respondiendo el usuario se va actualizando un indicador
      del progreso de llenado del perfil. Cada pregunta/respuesta tiene el
      mismo valor para calcular el progreso de llenado.
    \end{enumerate}
  \item El usuario puede elegir continuar con la siguiente sección o dar click
    en el encabezado de otra sección.
  \item El sistema salva la información en cuanto el usuario selecciona
    una respuesta. Al obtener nueva información el sistema debe recalcular
    las recomendaciones asociadas al edificio.
  }
  \additemizedfield{Postcondiciones:}{
  \item Un perfil del edificio mas detallado si el usuario dio respuesta a una
    pregunta sin contestar sobre su edificio.
  \item Si el usuario dio nueva información se recalculan las recomendaciones
    asociadas al edificio.
  }
\end{usecase}

\subsection{Obtener información del edificio}

Uno de los requerimientos mas importante para \texttt{PEAT} es el incentivar y
obtener mas información sobre las características de los edificios del usuario.
Esto es porque entre mas información se obtiene de estos se pueden generar
mejores planes de ahorro y recomendaciones para el usuario.

La forma en como se aborda esta necesidad es por medio de la implementación
de un componente que esta presente en las dos partes principales del sistema:
el plan de ahorro y la lista de recomendaciones. Este componente tiene el
nombre de Componente de Ingreso Progresivo de Información (\textit{Progressive
  Profile Widget} PPW). Este componente realiza una sola pregunta al usuario
obteniendo progresivamente mas información sobre el edificio.

\begin{usecase}
  \addtitle{Caso de Uso:}{Obtener información del edificio.}
  \addfield{Descripción:}{El sistema va obteniendo información
    progresivamente del usuario haciendo uso de un componente que
    realiza una pregunta al usuario en varias partes del sistema.
    Este componente tiene el nombre de Componente de Ingreso Progresivo de
    Información (\textit{Progressive Profile Widget} PPW).}
  \addfield{Actor:}{Usuario PyME}
  \additemizedfield{Precondiciones:}{
  \item El usuario a sido autentificado por medio de un token de autenticación
    (\textit{Single Sign On} SSO) asignado por el sistema de PG\&E.
  \item El usuario a creado previamente el perfil básico del edificio.
  }
  \addfield{Requerimientos no funcionales:}{
    Las actualizaciones a la pagina deben hacerse en forma
    asíncrona y sin necesitar una recarga completa de la pagina.
  }
  \addscenario{Flujo normal:}{
  \item El sistema despliega el componente PPW en la parte izquierda en las
    pantallas de plan de ahorro y de recomendaciones.
  \item Dentro del PPW, se presenta al usuario una pregunta a responder
    \begin{enumerate}
    \item Dependiendo de la pregunta, el usuario puede seleccionar una
      respuesta de una lista desplegable, seleccionar casillas,
      responder Si o No con un botón radial o ingresar un valor
      en un campo.
    \item Cada tipo de edificio tiene una lista predefinida ordenada de
      preguntas a ser desplegadas en el componente.
    \item Algunas preguntas tienen imágenes asociadas para facilitar
      al usuario su respuesta.
    \end{enumerate}
  \item El usuario puede o bien responder la pregunta, saltar la pregunta o
    no hacer nada en el PPW.
    \begin{enumerate}
    \item Si el usuario responde:
      \begin{enumerate}
      \item La respuesta provoca un refinamiento del perfil del edificio y
        el nuevo calculo de las recomendaciones propuestas.
        \begin{enumerate}[i.]
        \item El perfil del edificio es actualizado, las recomendaciones
          son recalculadas.
        \item El sistema despliega un indicador de progreso mientras
          se recalculan las recomendaciones.
        \item Al finalizar el refinamiento el orden de las preguntas
          o los valores del plan de ahorro deben ser actualizados, esto
          debe hacerse sin necesitar una recarga completa de la pagina.
        \end{enumerate}
      \item El sistema despliega la siguiente pregunta.
      \item El sistema persiste la respuesta dada.
      \end{enumerate}
    \item Si el usuario elige saltar la pregunta entonces el sistema
      despliega la siguiente pregunta sin necesitar de una respuesta por el usuario.
    \end{enumerate}
  \item Desde el PPW, el usuario puede dar click a ''Building Profile''\ para ver
    el perfil detallado del edificio.
  }
  \additemizedfield{Postcondiciones:}{
  \item Un perfil del edificio mas detallado si el usuario dio respuesta a la
    pregunta desplegada sobre su edificio.
  \item Si el usuario dio nueva información se recalculan las recomendaciones
    asociadas al edificio.
  }
\end{usecase}

\subsection{Administrar recomendaciones}

En los casos de uso anteriores se obtiene del usuario el perfil del edificio
y por lo menos sus características básicas. Haciendo uso de esta información
el sistema \texttt{PEAT} genera recomendaciones sobre como disminuir el consumo
de energía a través de cambios de comportamiento y/o modernización de equipo.

Las recomendaciones se muestran en tres partes del sistema:
\begin{enumerate}
\item En el plan de ahorro.
\item En las recomendaciones.
\item En el perfil detallado del edificio.
\end{enumerate}

\begin{usecase}
  \addtitle{Caso de Uso:}{Administrar recomendaciones.}
  \addfield{Descripción:}{El sistema despliega una lista de todas las
    recomendaciones que se ajustan al perfil del edificio.}
  \addfield{Actor:}{Usuario PyME}
  \additemizedfield{Precondiciones:}{
  \item El usuario a sido autentificado por medio de un token de autenticación
    (\textit{Single Sign On} SSO) asignado por el sistema de PG\&E.
  \item El usuario a creado previamente el perfil básico del edificio.
  }
  \additemizedfield{Requerimientos no funcionales:}{
  \item Cualquier acción en una recomendación debe hacerse en forma
    asíncrona y sin necesitar una recarga completa de la pagina.
  }
  \addscenario{Flujo normal:}{
  \item El sistema despliega las recomendaciones, ya sea en el plan
    de ahorro, la lista de recomendaciones o en el perfil detallado del edificio.
  \item El usuario puede tomar las siguientes acciones:
    \begin{itemize}
    \item Añadir al plan (de ahorro).
      \begin{enumerate}
      \item Cuando el usuario da click a ''Añadir al plan'', una ventana modal
        se abre y pregunta: ''¿ Cuando piensa completar esta acción ?''.
      \item El sistema proporciona lista predefinida de rangos de tiempo:
        una semana, un mes, tres meses, etcétera.
      \item El usuario elige el rango de tiempo adecuado y da click
        a ''Add to plan''
      \item El sistema añade la recomendación al plan de ahorro del edificio.
      \end{enumerate}
    \item No aplica.
      \begin{enumerate}
      \item El sistema mueve la recomendación al final de la lista de
        recomendaciones.
      \item En cualquier momento, el usuario puede cambiar el estado de la
        recomendación, es decir añadir la recomendación al plan de ahorro
        o indicar que no es aplicable al edificio.
      \end{enumerate}
    \item Ya completado.
      \begin{enumerate}
      \item El sistema mueve la recomendación al final de la lista de
        recomendaciones.
      \item En cualquier momento, el usuario puede cambiar el estado de la
        recomendación, es decir añadir la recomendación al plan de ahorro
        o indicar que no es aplicable al edificio.
      \end{enumerate}
    \end{itemize}
  \item El sistema refina y reordena la lista de recomendaciones después de que
    el usuario realiza cualquiera de las acciones anteriores.
  }
  \addscenario{Flujo alternativo:}{
  \item El usuario contesta alguna pregunta en el PPW o en el perfil detallado del
    edificio.
  \item El sistema refina y reordena la lista de recomendaciones después de que
    el usuario realiza cualquiera de las acciones anteriores.
  }
  \additemizedfield{Postcondiciones:}{
  \item Si el usuario añadió una recomendación a su plan de ahorro entonces
    se tiene un plan de ahorro actualizado.
  \item Si el usuario realizo cualquier acción en una recomendación entonces
    la lista de recomendaciones es actualizada y reordenada.
  }
\end{usecase}

\subsection{Ver recomendación}

En el plan de ahorro, la lista de recomendaciones o en el perfil detallado
del edificio solo se despliega el titulo y descripción breve de cada
recomendación. Entonces es necesario proporcionar al usuario mas información
detallada sobre la recomendación que el usuario quiere implementar.

\begin{usecase}
  \addtitle{Caso de Uso:}{Ver recomendación}
  \addfield{Descripción:}{El sistema despliega información adicional
    sobre una recomendación para que el usuario pueda elegir
    implementarla.}
  \addfield{Actor:}{Usuario PyME}
  \additemizedfield{Precondiciones:}{
  \item El usuario a sido autentificado por medio de un token de autenticación
    (\textit{Single Sign On} SSO) asignado por el sistema de PG\&E.
  \item El usuario a creado previamente el perfil básico del edificio.
  }
  \addfield{Requerimientos no funcionales:}{
    Cualquier acción en una recomendación debe hacerse en forma
    asíncrona y sin necesitar una recarga completa de la pagina.
  }
  \addscenario{Flujo normal:}{
  \item El usuario ve una recomendación que capta su atención y da un
    click en el titulo de la recomendación.
  \item El sistema despliega información adicional sobre la recomendación, por
    ejemplo cuanto ahorro daría realizar la recomendación, que se necesita
    hacer para obtener este ahorro, etcétera.
  \item El usuario puede realizar las acciones definidas en el caso
    de uso anterior es decir, añadir la recomendación al plan de ahorro
    indicar que no aplica o indicar que ya ha sido completada la recomendación.
  }
  \addfield{Postcondiciones:}{
    Si el usuario realizo cualquier acción en una recomendación entonces
    la lista de recomendaciones es actualizada y reordenada.
  }
\end{usecase}

\subsection{Ver historial de consumo}

\begin{usecase}
  \addtitle{Caso de Uso:}{Ver historial de consumo}
  \addfield{Descripción:}{Se muestra el consumo energético del edificio
    mediante un conjunto de gráficas con múltiples vistas para diferentes
    rangos de tiempo, categorías rangos de tiempo y categorías.}
  \addfield{Actor:}{Usuario PyME}
  \additemizedfield{Precondiciones:}{
  \item El usuario a sido autentificado por medio de un token de autenticación
    (\textit{Single Sign On} SSO) asignado por el sistema de PG\&E.
  \item El usuario a creado previamente el perfil básico del edificio.
  }
  \addfield{Requerimientos no funcionales:}{
    Las actualizaciones a la pagina deben hacerse en forma asíncrona y sin necesitar
    una recarga completa de la pagina.
  }
  \addscenario{Flujo normal:}{
  \item El sistema despliega inicialmente una gráfica del gasto anual de
    electricidad y gas del edificio.
  \item El sistema muestra un menú con las siguientes opciones de visualización:
    \begin{itemize}
    \item Gasto: Medido en dolares con gráficas anuales, mensuales y diarias.
    \item Electricidad: Medido en kilowatt-hora con gráficas anuales, mensuales y
      diarias.
    \item Gas: Medido en termia, con gráficas anuales, mensuales y diarias
    \item Emisiones de carbón: Medido en toneladas, con gráficas anuales, mensuales
      y diarias.
    \item Análisis: Gráfica que indica el consumo estimado según la categoría.
      Las categorías son por ejemplo: refrigeración, iluminación, calefacción,
      etcétera.
    \end{itemize}
  }
  \addfield{Postcondiciones:}{
    El sistema se mantiene en el mismo estado.
  }
\end{usecase}

\subsection{Administrar plan de ahorro}

El plan de ahorro esta diseñado para ser la pagina principal del sistema
\texttt{PEAT} cuando el usuario ya creado por lo menos un perfil de edificio.

\begin{usecase}
  \addtitle{Caso de Uso:}{Administrar plan de ahorro}
  \addfield{Descripción:}{El sistema debe permitir la administración
    del plan de ahorro del edificio que consiste en un conjunto de recomendaciones
    que el usuario sea a comprometido a realizar o que ya ha completado
    para reducir su gasto energético.}
  \addfield{Actor:}{Usuario PyME}
  \additemizedfield{Precondiciones:}{
  \item El usuario a sido autentificado por medio de un token de autenticación
    (\textit{Single Sign On} SSO) asignado por el sistema de PG\&E.
  \item El usuario a creado previamente el perfil básico del edificio.
  }
  \addfield{Requerimientos no funcionales:}{
    Las actualizaciones a la pagina deben hacerse en forma asíncrona y sin necesitar
    una recarga completa de la pagina.
  }
  \addscenario{Flujo normal:}{
  \item El usuario no ha agregado ninguna recomendación a su plan
    \begin{enumerate}
    \item Las tres mejores recomendaciones son desplegadas dentro del marco
      del plan de ahorro
    \item El sistema elige estas recomendaciones por medio de la siguiente lógica:
      \begin{itemize}
      \item Son ordenadas según su periodo de recuperación (definido por el ahorro
        anual en dólares / costo en dólares por adelantado).
      \item Recomendaciones con costo inicial cero (por ejemplo, acciones basadas
        en comportamiento) se consideran que tienen un reembolso de dos años.
      \item Las recomendaciones que han sido marcadas como completadas o que no aplican
        no son parte de la selección para el plan de ahorro.
      \end{itemize}
    \end{enumerate}
  \item El usuario a agregado una o mas recomendaciones a su plan de ahorro.
    \begin{itemize}
    \item La mejor recomendación es desplegada debajo del componente PPW
    \item El sistema despliega una lista de las recomendaciones que el usuario
      a agregado a su plan.
      \begin{itemize}
      \item El sistema debe indicar que la lista de recomendaciones es el plan
        de ahorro.
      \item El usuario puede agregar mas recomendaciones desde la lista de
        recomendaciones, cuando se añade una recomendación esta solamente es
        visible en el plan de ahorro ya no debe de aparecer en la lista de
        recomendaciones
      \item El usuario puede remover recomendaciones de su plan seleccionando
        ''Remover del plan'' en un menú desplegable al lado del nombre de la
        acción.
      \end{itemize}
    \item El usuario puede ordenar la lista por nombre, categoría, costo, ahorro
      o reembolso.
    \item El usuario puede obtener mas información al dar click en el nombre
      de la recomendación.
    \item El usuario actualiza el estado de una recomendación a ''Completada''
      o ''Remover''.
      \begin{itemize}
      \item Las recomendaciones dentro del plan de ahorro solo pueden tener
        dos posibles estados: ''Completada'' y ''Remover'', el estado base
        de una recomendación agregada al plan es de ''Añadida''.
      \item Las recomendaciones con estado de ''Completada'' permanecen
        en el plan de ahorro con la selección ''Completada'' desplegada
        al lado del nombre de la acción.
      \end{itemize}
    \end{itemize}
  }
  \addfield{Postcondiciones:}{
    Si el usuario realizo cualquier acción en una recomendación entonces el plan
    de ahorro es actualizado y reordenado.
  }
\end{usecase}

\section{Interfase de usuario}

Dados los requerimientos funcionales y no funcionales presentados en los
casos de uso se tiene que la interfaz de usuario debe tener las siguientes
características:

\begin{itemize}
\item La interfaz debe permitir realizar la mayoría de sus
  acciones de forma asincrónica, sin necesidad de una recarga completa de
  la pagina.
\item La interfaz debe ser simple y enfocada a la información que el
  usuario necesita
\item Toda interacción debe completarse en menos de un segundo.
\end{itemize}

Para cumplir estos requerimientos era necesario una cantidad considerable
de código Javascript en la parte del \textit{frontend}, para realizar peticiones
al servidor de forma asíncronas por medio de AJAX, y realizar las actualizaciones
a la vista después de recibir la respuesta del servidor.

Para implementar los componentes como la lista de recomendaciones y el componente
PPW, además de las llamadas AJAX para realizar actualizaciones en la pagina era
una cantidad considerable de código Javascript que debía ser implementado, para
dar estructura a este código del \texttt{frontend} se eligió usar la biblioteca
\textit{Backbone} puesto que permite definir una arquitectura MVC, es decir
permite definir modelos, vistas y controladores en la parte del \texttt{frontend}.

\subsection{Descripción general y navegación}

La interfaz de usuario en el sistema \texttt{PEAT} esta compuesta por ocho paginas
de las cuales tres son paginas de PG\&E y las restantes son gestionadas por el
sistema \texttt{PEAT}:

\begin{enumerate}
\item Un usuario entra al portal de PG\&E, luego a la pagina de ingreso del
  sistema \textit{MyEnergy} de PG\&E, en este sistema es donde los usuarios PyME
  hacen la administración de su perfil y cuentas con PG\&E. En el tablero de
  \textit{MyEnergy} se tiene una liga que invita al usuario a saber sobre
  medidas para ahorrar, esta liga dirige al usuario al sistema \texttt{PEAT}
  (Ver Figura 3.3 1).
\item En el primer ingreso del usuario al sistema este es redirigido a la pagina
  \textquote{Crear perfil del edificio}, aquí el usuario solo contesta las preguntas
  básicas sobre su edificio. El usuario regresa a esta pagina cuando requiere
  agregar mas edificios a su cuenta (Ver Figura 3.3 2). Al finalizar la creación
  del perfil se redirige al usuario al plan de ahorro.
\item La pagina \textquote{Plan de ahorro} es la pagina principal del sistema
  \texttt{PEAT}, es donde los usuarios que ya cuentan por lo menos con un perfil
  de edificio son redirigidos al ingresar por medio de su tablero en
  \textit{MyEnergy} (Ver Figura 3.3 3).
  El plan de ahorro presenta dos funcionalidades al usuario:
  \begin{itemize}
  \item Parte superior: se proporciona al usuario capacidad para interactuar
    con la facturación de sus gastos de energía por medio de gráficas comparativas,
    es decir esta parte implementa la funcionalidad indicada en el caso de uso
    \textit{Ver historial de consumo}.
  \item Parte inferior: se proporciona al usuario su plan de ahorro y las
    medidas que se ha comprometido a realizar para reducir su gasto, es decir
    esta parte implementa la funcionalidad indicada en el caso de uso
    \textit{Administrar plan de ahorro}
  \end{itemize}
  El usuario puede navegar a las paginas \textquote{Perfil detallado},
  \textquote{Recomendaciones} y \textquote{Detalle recomendación}.
\item En la pagina \textquote{Recomendaciones} se tiene dos componentes
  (Ver Figura 3.3 4):
  \begin{itemize}
  \item El componente PPW que incita la usuario a dar mas información
    sobre su edificio.
  \item Una lista de recomendaciones para reducir sus costos de energía
    basados en el perfil de su edificio, es decir esta parte
    implementa la funcionalidad indicada en el caso de uso
    \textit{Administrar recomendaciones}.
  \end{itemize}
  El usuario puede navegar a las paginas \textquote{Perfil detallado del edificio},
  \textquote{Plan de ahorro} y \textquote{Detalle recomendación}.
\item La pagina \textquote{Perfil detallado del edificio} es donde el usuario
  puede responder o actualizar las respuestas a las preguntas sobre su edificio,
  es decir esta pagina implementa la funcionalidad indicada en el caso de uso
  \textit{Administrar perfil del edificio} (Ver Figura 3.3 5).
  El usuario puede navegar a las paginas \textquote{Plan de ahorro} y
  \textquote{Recomendaciones}.
\item La pagina \textquote{Detalle recomendación} muestra los pormenores sobre
  las medidas que se necesitan implementar para lograr reducir el consumo de energía,
  es decir esta pagina implementa la funcionalidad indicada en el caso de uso
  \textit{Ver recomendación} (Ver Figura 3.3 6).
  El usuario puede navegar a las paginas \textquote{Plan de ahorro} y
  \textquote{Recomendaciones}.
\end{enumerate}

\jcimageinline{1.0}{imagenes/UI-Navegacion.png}{Diagrama de alto nivel de
  la navegación en el sistema \texttt{PEAT}.}

\subsection{Diseño de página}

\subsubsection{Encabezado}

Todas las paginas del sistema \texttt{PEAT} comparte el mismo encabezado
que tiene las siguientes secciones:

\begin{enumerate}[a)]
\item Control de selección de edificios: Este control muestra un menú
  desplegable el cual muestra al usuario cada uno de los edificios
  asociados a su cuenta.
\item Nombre del sistema. Aunque el nombre interno del sistema es \texttt{PEAT}
  para el usuario el nombre es \textquote{Chequeo de energía del negocio}
  (\textit{Business Energy Checkup}).
\item Menú de navegación del sistema.
  \begin{itemize}
  \item Plan de ahorro (\textit{Energy Plan}): dirige al usuario a la pagina
    \textquote{Plan de ahorro}.
  \item Formas de ahorrar (\textit{Ways to Save}): dirige al usuario a la pagina
    \textquote{Recomendaciones}.
  \item Perfil de negocio (\textit{Business Profile}): dirige al usuario a la pagina
    \textquote{Administrar perfil del edificio}.
  \item Tomar un recorrido (\textit{Take a tour}): se muestra al usuario
    las diferentes paginas y secciones del sistema.
  \end{itemize}
\item Titulo de la pagina actual.
\item Control de potencial de ahorro: este control muestra en todo momento
  el potencial de ahorro del edificio y el ahorro que se obtiene por el plan
  de ahorro del edificio.
\end{enumerate}

\jcimageinline{1.0}{imagenes/Disposicion-Encabezado.png}{Encabezado principal
  del sistema \texttt{PEAT}.}


\subsection{Crear perfil del edificio}

La pagina de \textquote{Crear perfil del edificio} es la pagina inicial
que el usuario visualiza cuando no tiene ningún perfil de edificio asociado,
esta pagina también es usada cuando el usuario agrega mas edificios a su
cuenta.

Esta pagina tuvo varias varias implementaciones por retroalimentación de
pruebas con usuarios, en las primeras versiones se tenia que la pagina
requeria que el usuario contestara toda la informacion requerida como se
documenta en el caso de de uso \textit{Crear perfil del edificio}, esto
representaba mucho trabajo al usuario (Ver Figura 3.4).

\jcimageinline{0.75}{imagenes/SBP-Wireframe.png}{Boceto inicial para crear
  un perfil de edificio.}

Para facilitar al usuario el ingreso de información se decidió implementar
las siguientes mejoras:

\begin{enumerate}
\item Se redujo el numero de opciones para el tipo de industria, inicialmente
  esta lista era numerosa lo que implicaba mas trabajo al usuario, se redujo
  a cinco opciones que son visibles inmediatamente.
\item Se dividió el ingreso de información en dos partes.
\end{enumerate}

En la versión final el sistema inicialmente pide al usuario seleccionar el tipo
de industria que mejor describe su negocio, las opciones son: Comercial, Industrial,
Agricultura, Habitacional, Otro (Ver Figura 3.5).

\jcimageinline{0.75}{imagenes/SBP-Modal1.png}{Se pide al usuario
  el seleccionar el tipo de industria de su negocio.}

Después el sistema pide al usuario seleccionar su cuenta y dirección
de servicio, ingresar el alias del edificio, el tipo de edificio y su área
(Ver Figura 3.6).

\jcimageinline{0.75}{imagenes/SBP-Modal2.png}{Se pide al usuario ingresar
  las características básicas de su edificio.}

Al ingresar esta información el usuario es redirigido a la pagina
\textquote{Plan de ahorro} del perfil creado.

\subsection{Plan de ahorro}

La pagina \textquote{Plan de ahorro} es la pagina principal del sistema
\texttt{PEAT} dado que implementa la funcionalidad principal del sistema
que es la capacidad para interactuar con los datos sobre los gastos de
energía y la administración el plan de ahorro del edificio.

La pagina esta dividida en dos partes principales, en la parte superior
se da el manejo de las gráficas para visualizar los gastos y en la parte
inferior se tiene la administración del plan de ahorro.

\subsubsection{Visualización}

La parte superior esta subdividida en las siguientes partes:
\begin{itemize}
\item Menú de vistas: En esta barra el usuario puede seleccionar
  que tipo de información que se despliega en las gráficas. Se tienen cuatro tipos
  de vista: gasto (\textit{Spending}), electricidad (\textit{Electricity}), gas
  (\textit{Gas}), emisiones de carbono (\textit{Carbon Emissions}) y análisis
  (\textit{Energy Use}). También en este menú en la parte derecha se
  tiene un estimado del ahorro que se puede obtener en el edificio
  si se implementan las recomendaciones (Ver Figura 3.7).
  \jcimage{1.0}{imagenes/Barra-Vistas-Ahorro.png}{Menú de vistas.}
\item Menú de rango de tiempo: Esta sección se encuentra enseguida del menú de
  vistas, aquí el usuario puede seleccionar entre los rangos de tiempo ya sea anual
  (\textit{Annually}), mensual o diario de la vista anterior, en ciertas vistas
  además se opciones extra la parte derecha para agregar información del clima y
  comparativas con periodos anteriores (Ver Figura 3.8).
  \jcimage{1.0}{imagenes/Barra-Rango.png}{Menú de rango de tiempo.}
\item Área de visualización: En esta sección se despliega los datos de consumo
  del edificio mostrando los datos y rango de tiempo que el usuario ha seleccionado
  en los dos menús anteriores (Ver Figura 3.9).
  \jcimage{1.0}{imagenes/Grafica.png}{Visualización del gasto de electricidad con
    comparativa del año anterior y el clima.}
\end{itemize}

Para la implementación de las gráficas se utilizo el marco de trabajo
Ext JS, este marco de trabajo esta diseñado para la implementación
de aplicaciones de tipo \textit{SPA} por medio del lenguaje de programación
Javascript. Ext JS implementa un gran numero de controles como
como paneles, barras de herramientas, deslizadores, etcétera.

Ext JS es una elección natural para el sistema \texttt{PEAT} tiene un gran
paquete de graficación el cual permite la representar visualmente los datos con una
amplia gama de tipos de graficas: lineas, barras, circulares. Además el equipo
de \textit{frontend} estaba ampliamente familiarizado en la implementación y
personalización de visualizaciones con este marco de trabajo.

Dado la capacidad de Ext JS para interfaces se tenia inicialmente
que todo la funcionalidad de la interfaz se haría con este marco de trabajo pero
la desventaja es que requiere de un tiempo de inicialización demasiado grande,
mas de un segundo, que va contrario a los requerimiento de PG\&E.
Así se decidió hacer uso solamente del modulo de graficación de Ext JS y
hacer la implementación de los controles necesarios para la interfaz desde cero
haciendo uso de \texttt{Backbone}.

Para cada rango de tiempo se hace uso de un tipo diferente de gráfica:
\begin{itemize}
\item Anual: Se hace una comparativa entre el gasto del edificio en los últimos doce
  meses, el promedio de gasto de un edificio de características similares y
  el gasto de un edificio eficiente en consumo energético. Para hacer estas
  comparaciones se utiliza gráficas de barras.
  \jcimage{1.0}{imagenes/Vista-Anual.png}{Visualización anual del gasto de
    electricidad.}
\item Mensual: Se muestra una gráfica con el gasto del edificio en los últimos 12
  meses, permite comparar con el gasto del año anterior.
  \jcimage{0.9}{imagenes/Vista-Mensual.png}{Visualización mensual del gasto de
    electricidad.}
\item Diario: Se muestra una gráfica similar a la vista mensual pero en este caso
  se visualizan los últimos treinta días de gasto, además permite comparar
  con el gasto en el mismo periodo del año pasado.
  \jcimage{0.9}{imagenes/Vista-Diaria.png}{Visualización diaria del gasto de
    electricidad.}
\item Análisis: Se muestra un análisis del gasto del edificio en categorías
  por medio de una gráfica circular o de sectores, este análisis es realizado
  usando aprendizaje de maquina por lo que esto es solo una estimación del consumo
  de cada categoría.
  \jcimage{0.9}{imagenes/Vista-Analisis.png}{Visualización del análisis del gasto de
    electricidad.}
\end{itemize}

Aunque las figuras solo muestran el caso del gasto en electricidad las
visualizaciones son idénticas para el gasto en gas.

\subsubsection{Administración}

La parte inferior esta subdividida en las siguientes partes:
\begin{itemize}
\item Componente PPW: En esta región se despliega una pregunta
  sobre el edificio del usuario, sus características se
  verán con detalle en la sección \textit{Foo}.
\item Lista de recomendaciones: Esta sección se despliega la lista de recomendaciones
  que forman el plan de ahorro del edificio. Esta lista de recomendaciones junto con
  el componente PPW son los widgets principales del sistema \texttt{PEAT}.
  Las características de este componente se verán a detalle en la sección
  \textit{Bar}.
  \jcimage{1.0}{imagenes/Plan-Energia-Inicial.png}{Plan de energía inicial con
    recomendaciones.}
\end{itemize}

\subsection{Recomendaciones}

La pagina \textquote{Recomendaciones} es la pagina en la que se muestran
las recomendaciones que aplican al edificio del usuario.

En la parte lateral se tiene el componente PPW, y en el parte principal
se tiene el widget que maneja la lista de recomendaciones.

La lista de recomendaciones consta de las siguientes partes:
\begin{itemize}
\item Encabezado: Se tiene las características principales por las cuales
  el usuario puede ordenar la lista: nombre, categoría, costo, ahorro y recuperación
  de la inversión.
  \jcimage{1.0}{imagenes/Recomendaciones-Encabezado.png}{Encabezado de la lista
    de recomendaciones.}
\item Renglón: Se despliega por cada recomendación sus características principales
  además se tiene un botón que permite al usuario cambiar el estatus de la
  recomendaciones. Para cada recomendación se tiene las siguientes secciones:
  \begin{enumerate}[a)]
  \item Imagen representativa de la recomendación.
  \item Descripción de una linea de la recomendación.
  \item Categoría de la recomendación.
  \item Costo de implementar la recomendación.
  \item Ahorro que trae la recomendación medida por año.
  \item Tiempo para recuperar la inversión, es decir cuanto tiempo el ahorro
    obtenido por implementar la recomendación es igual o superior al costo
    de su implementación.
  \item Breve descripción de las medidas necesarias para implementar la
    recomendación.
  \item Control añadir al plan, este botón/menú permite al usuario definir el
    estado de la recomendación, es decir si la recomendación se debe
    añadir al plan de ahorro, es una recomendación que ya fue implementada o
    que no aplica al edificio.
  \end{enumerate}
  \jcimage{1.0}{imagenes/Recomendaciones-Renglon.png}{Las secciones de una
    recomendación.}
\end{itemize}

\subsubsection{Botón de añadir al plan}

Una recomendación tiene los siguientes estados:
\begin{itemize}
\item Por implementar: En este estado la recomendación no es parte
  del plan de ahorro del edificio. Este es el estado inicial de toda
  recomendación.
\item Añadido: En este estado la recomendación ha sido elegida
  por el usuario para su implementación.
\item No aplica: En este estado se indica que la recomendación
  no es aplicable al edificio.
\item Completada: En este estado se indica que la recomendación
  ya ha sido implementada en el edificio.
  \jcimage{1.0}{imagenes/Recomendaciones-Renglon.png}{Las secciones de una
    recomendación.}
\end{itemize}

Mediante la interacción con el control de añadir al plan es que un usuario
modifica el estado de una recomendación. El control es una combinación
de botón, para la acción principal de añadir una recomendación, y una lista
despegable de acciones secundarias como remover o indicar que ya ha sido
completada una recomendación.

Para realizar la transición del estado 'Por implementar' al estado 'Añadido' el
usuario solo tiene que presionar el control en su parte izquierda.
\jcimage{0.5}{imagenes/Boton-Plan-Inicial.png}{Vista inicial del control
  de añadir al plan.}
\jcimage{0.5}{imagenes/Boton-Plan-Anadido.png}{Vista cuando la recomendación
  a sido añadida al plan.}

El sistema despliega una ventana modal preguntando al usuario que tan
rápido estima que podrá implementar las medidas de la recomendación
que esta agregando
\jcimage{0.5}{imagenes/Recomendaciones-Estimacion.png}{Al agregar una
  recomendación al plan el sistema pregunta el tiempo estimado para completar
  la recomendación.}


Para realizar las otras transiciones el usuario debe presionar la parte derecha
del control en la parte que se tiene un triangulo indicando un menú despegable.
Dado un estado inicial se despliegan las opciones para indicar que la
recomendación ya ha sido completada o que no es aplicable.

\jcimage{0.5}{imagenes/Boton-Plan-Menu-Inicial.png}{Las acciones de
  completar o indicar no aplicable en el menu despegable.}.

Cuando la recomendación esta en el estado 'Añadido' en el menú despegable
se despliegan las acciones de completar, remover o indicar que no es aplicable
la recomendación.
\jcimage{0.5}{imagenes/Boton-Plan-Menu-Anadido.png}{Las acciones de
  completar o indicar no aplicable en el menu despegable.}.

\subsection{Detalle recomendación}

La pagina \textquote{Detalle recomendación} es donde se describe la
recomendación y las medidas que se tienen que implementar para lograr
reducir el consumo de energía del edificio.

La pagina esta dividida en las siguientes partes:
\begin{itemize}
\item Encabezado: Se muestra una descripción breve de la recomendación y a su
  derecha se tiene el control 'añadir al plan'.
  \jcimage{1.0}{imagenes/Recomendacion-Titulo.png}{Encabezado de la recomendación
    para la instalación de un sistema de paneles solares.}
\item Descripción detallada: En el contenido principal se describe con detalle
  la información sobre las medidas necesarias para reducir el consumo de energía.
  Dentro de la descripción se pueden tener una o varias preguntas al usuario
  de tal forma que se obtiene la información necesaria para dar al usuario
  una mejor estimación sobre los costos y ahorro que pueden esperar si es
  completada la recomendación.
  En la barra lateral se despliega el resultado de un calculo estimado
  de costos y ahorro al realizar la recomendación, estos datos son
  actualizados de forma asincrona cuando el usuario contesta o cambia
  la respuesta a alguna de las preguntas presentadas en el contenido
  principal.
  \jcimage{1.0}{imagenes/Recomendacion-Descripcion.png}{Las acciones de
    completar o indicar no aplicable en el menu despegable.}
\end{itemize}

\subsection{Perfil detallado del edificio}

La pagina \textquote{Perfil detallado del edificio} es donde el usuario
puede responder o actualizar la información sobre su edificio al contestar
o actualizar las respuestas a las preguntas sobre su edificio.

La pagina esta dividida en varias secciones, una sección por categoría:
\begin{itemize}
\item Edificio (\textit{Building})
\item Iluminación (\textit{Lightning})
\item Calefacción, ventilación y aire acondicionado (\textit{Heating, Ventilation and Air Conditioning} HVAC)
\item Refrigeracion (\textit{Refrigeration})
\item Cocina (\textit{Cooking})
\item Calefaccion de agua (\textit{Water-Heating})
\item Miscelánea (\textit{Misc})
\end{itemize}

Varias categorías como cocina y refrigeración solo son mostradas
para ciertos tipos de edificios

\jcimage{1.0}{imagenes/Perfil-Secciones.png}{Las preguntas sobre
  el edificio se organizan en categorías.}

El usuario selecciona una categoria dando un click al titulo de una categoria,
entonces esta categoria se abre para presentar las preguntas y respuestas
asociadas a esta.

Cada seccion esta dividida en las siguientes secciones:
\begin{enumerate}
\item Encabezado de la sección: cada encabezado tiene un icono característico,
  el nombre de la categoría y en la parte derecha un marcador para indicar
  si todas las preguntas de la sección han sido respondidas por el usuario.
\item Preguntas y respuestas: las preguntas son breves y se refieren a una
  característica particular del edificio. La mayoría de las preguntas
  tiene respuestas definidas, teniendo solo un reducido numero de preguntas
  espera un valor numérico del usuario. Las respuestas se
  presentan en las siguiente maneras:
  \begin{enumerate}[a)]
  \item Menú desplegable: para preguntas que tienen mas de tres respuestas
    posibles excluyentes.
  \item Casillas de selección múltiple: para preguntas en que las respuestas
    pueden ser validas al mismo tiempo.
  \item Campo de texto limitado (solo un valor numérico): para las preguntas
    en que se necesita un valor numérico exacto.
  \item Botón de opción (con texto o imagen): para preguntas que tiene un
    numero limitado de respuesta posibles. Se hace uso de imágenes para las
    diferentes respuestas para facilitar al usuario el contestar las preguntas
    mas técnicas.
  \end{enumerate}
\item Botón para progresar a la siguiente categoría.
\end{enumerate}

\jcimage{1.0}{imagenes/Perfil-Preguntas.png}{Las preguntas de las secciones
  Edificio y HVAC.}

\subsection{Componentes reusables}

En el sistema \texttt{PEAT} se tiene funcionalidad que se requiere en
varias de las paginas del sistema, un ejemplo concreto seria la necesidad
de mostrar una pregunta sin contestar al usuario sobre su edificio.
Se decidió entonces implementar varios componentes que implementar la
funcionalidad que es requerida en varias partes del sistema, permitiendo
el reuso de código y diseño y acelerando notablemente la implementación
del sistema.

Los componentes que se implementaron son los siguientes:
\begin{itemize}
\item Componente de ingreso progresivo: este componente implementa
  la funcionalidad de mostrar al usuario una pregunta sobre una
  característica de su edificio.
\item Componente lista de de recomendaciones
\item Componente añadir al plan: este componente permite
  modificar el estado de una recomendación, es decir si esta es parte del
  plan de ahorro, no es aplicable o ya se completo.
\item Componente potencial de ahorro: este componente permite
  al usuario saber el potencial de ahorro del edificio y su
  ahorro esperado según su plan de ahorro.
\end{itemize}

\subsubsection{Componente de ingreso progresivo}

Este componente es usado en las paginas \textquote{Plan de ahorro} y
\textquote{Recomendaciones}.

\subsubsection{Componente añadir al plan}

Este componente es usado en las paginas \textquote{Plan de ahorro},
\textquote{Recomendaciones} y \textquote{Detalle recomendación}.

