\chapter{Diseño e implementación del sistema PEAT}

Para lograr los objetivos del sistema \texttt{PEAT} se dividió en cuatro
módulos principales:

\begin{itemize}
\item Perfil sencillo del edificio (\textit{Simple Building Profile}): este modulo
  realiza la configuración inicial del edificio del usuario, realizando solamente
  un numero limitado de preguntas básicas para lograr definir las características
  básicas del edificio.
\item Perfil detallado del edificio (\textit{Detailed Building Profile}):
  este modulo se encarga del manejo de las características básicas, detalladas y
  opcionales de un edificio.
\item Plan de ahorro de energía (\textit{Energy Savings Plan}): este modulo
  presenta el consumo de energía del edificio al usuario, también presenta las
  recomendaciones que el usuario se ha comprometido a poner en acción.
\item Recomendaciones (\textit{Recommendations}): este modulo genera una lista
  de medidas de ahorro de energía considerando la información ingresada al sistema
  hasta el momento. Aparte debe permitir al usuario obtener información detallada
  sobre las recomendaciones dadas.
\end{itemize}

Como se puede ver el modelo de edificio es el principal modelo dentro de
\texttt{PEAT}, por lo que lograr obtener una correcta correspondencia entre
el consumo energético y un edificio es de vital importancia para dar la
información mas correcta sobre edificio. Al tenerse una correcta asignación
sobre el consumo del edificio el sistema puede dar las mejores recomendaciones
según las características del edificio.

\section{Modelo de información}

El objetivo principal del modelo de información de \texttt{PEAT} es definir el
concepto de edificio y su relación con el consumo energético del usuario. Así
tenemos el concepto de edificio el cual es una estructura independiente a la
cual se le esta proporcionando electricidad o gas.

\subsection{Estructura de facturación de PG\&E}
Para obtener esta correspondencia entre edificio-consumo es necesario
tener en cuenta la estructura de facturacion usada por PG\&E puesto
que de esta estructura es que se obtiene el consumo de electricidad y gas.

El usuario, la cuenta y el contrato de servicio representan el lado demográfico
de modelo de información, la cual cambia bastante:

\begin{itemize}
\item Usuario: representa al cliente. Tiene una o mas cuentas.
\item Cuenta: representa la contabilidad financiera del usuario. Tiene uno o más
  contratos de servicio, uno por tipo (electricidad o gas), también tiene una o más
  direcciones de servicio asociadas.
\item Contrato de servicio: representa los servicios que el cliente adquiere
  de PG\&E, como la electricidad o el gas, puede tener uno o mas puntos
  de servicio asociados.
\end{itemize}

La dirección de servicio, el punto de servicio y el medidor representan
la parte geográfica del modelo de información, esta información raramente cambia:

\begin{itemize}
\item Dirección de servicio: es una ubicación física en donde se prestan los
  servicios, en \texttt{PEAT} son el modelo que se quiere asociar al modelo
  de edificio, puede tener uno o más puntos de servicio.
\item Punto de servicio: es una coordenada geográfica en donde se conectan los
  servicios, puede tener uno o más medidores.
\item Medidor: es un dispositivo instalado en un punto de servicio que registra el
  consumo del servicio.
\end{itemize}

La relación entre todos estos modelos se puede ver en la Figura 3.1.

%% Ahora dentro de la facturación de PG\&E un usuario puede tener una o varias
%% cuentas, a su vez cada cuenta tiene una o mas contratos de servicio asociados
%% esto es porque cada contrato representa los servicios que el usuario
%% requiere ya sea electricidad o gas.
%% Además cada cuenta tiene una o varias direcciones de servicio en donde se tiene
%% uno o varios puntos de servicio, donde se realiza la conexión eléctrica o de gas.
%% Finalmente un punto de servicio puede tener uno o varios medidores, los cuales
%% son dispositivos que registran el consumo del servicio dado (Ver Figura 3.1).

\jcimage{1.0}{imagenes/PGE-facturacion.png}{Modelos principales para la facturación en PG\&E.}

\subsection{Relación Edificio-Facturación}

Para que \texttt{PEAT} pueda cumplir sus requerimientos funcionales es necesario
definir claramente la relación entre un edificio y su consumo energético medido
por uno o varios medidores.
Aunque los medidores son los que tienen la información de consumo el relacionar
directamente un medidor con un edificio no es amigable para el usuario.
Por lo que para facilitar la creación del perfil de un edificio se pide al usuario
que haga la correspondencia entre las direcciones de servicio asociadas a su cuenta
y el perfil de edificio que se esta creando.
El usuario al dar esta correspondencia permite al sistema obtener los puntos
de servicio y sus medidores asociados al edificio y así obtener su consumo
energético para el edificio.

\section{Casos de uso}

\subsection{Diagrama general}

En la Figura 3.2 se muestra el diagrama general de casos de uso del sistema
\texttt{PEAT}. Se tienen once casos de uso en total siendo ocho casos para
\texttt{PEAT} y tres casos para la biblioteca \texttt{Bezel}.
Los casos de uso se agrupan en los cuatro módulos principales mencionados
anteriormente:

\begin{itemize}
\item Perfil sencillo del edificio (\textit{Simple Building Profile}): Tiene
  solo el caso de uso \textit{Crear perfil del edificio} pero este caso de uso
  es uno de los mas complejos en cuestión de interacción con el usuario y su
  importancia para obtener las características iniciales del edificio.
\item Perfil detallado del edificio (\textit{Detailed Building Profile}): Contiene
  los casos de uso \textit{Administrar perfil del edificio} y
  \textit{Obtener información del edificio} los cuales se encargan de la
  administración y obtención de información del edificio.
\item Plan de ahorro de energía (\textit{Energy Savings Plan}): Contiene los
  casos de uso \textit{Ver historial de consumo} y \textit{Ver plan de ahorro}
  que se enfocan a la visualización del consumo eléctrico del usuario y las
  posibles recomendaciones para disminuir su consumo.
\item Recomendaciones (\textit{Recommendations}): Contiene los casos de uso
  \textit{Ver lista de recomendaciones} y \textit{Ver recomendación}.
\end{itemize}

\jcimageinline{1.0}{imagenes/Diagrama-General-CasosDeUso.png}{Diagrama general de casos de uso de \texttt{PEAT}.}

\subsection{Crear perfil del edificio}

\begin{usecase}
  \addtitle{Caso de Uso:}{Crear perfil del edificio.}
  \addfield{Descripción:}{Un cliente PyME entra al sistema  para crear un perfil
    inicial de un edificio, respondiendo ciertas preguntas básicas sobre el
    edificio.}
  \addfield{Actor:}{Cliente PyME}
  \additemizedfield{Precondiciones:}{
  \item El usuario a sido autentificado por medio de un token SSO (Single Sign On)
    asignado por el sistema de PG\&E.
  \item Los datos de intervalo y de facturación del cliente esta en el sistema.
  }
  \addscenario{Flujo normal:}{
  \item El sistema checa si el cliente tiene mas de una cuenta.
  \item El sistema despliega el numero de cuenta.
  \item El usuario puede definir un alias a la cuenta.
  \item El sistema despliega las direcciones de servicio asociadas a la cuenta.
  \item El cliente debe ingresar la siguiente información sobre el edificio:
    \begin{enumerate}
    \item Tipo.
    \item Rango de tamaño.
    \item Antigüedad.
    \end{enumerate}
  \item El usuario puede ingresar los datos o cancelar.
  }
  \addfield{Postcondiciones:}{
    Se genera un identificador único para el perfil del edificio generado, el cual
    esta asociado a los datos de facturación de la cuenta del cliente PyME.
  }
\end{usecase}

\subsection{Administrar perfil del edificio}

Para el sistema \texttt{PEAT} se tiene las siguientes características:
\begin{itemize}
\item Básicas: son características básicas de un edificio: tipo, tamaño y
  antigüedad.
\item Detalladas: son las características mas significativas y fáciles de
  responder, ejemplos son: horas de operación, numero de empleados, numero
  de pisos, etcétera.
\item Opcionales: son características más avanzadas/técnicas sobre el equipo
  y estructura de un edificio.
\end{itemize}

Las características básicas son definidas al crear el perfil inicial de un
edificio como se documenta en el caso de uso anterior. Las características
detalladas y opcionales son definidas por medio de dos rutas:

\begin{itemize}
\item Por medio del perfil detallado del edificio, en la que se despliega
  las preguntas y respuestas sobre las características del edificio.
  Esta ruta es documentada en este caso de uso.
\item Un componente que es embebido en varias partes del sistema
  que hace una sola pregunta al usuario para ir obteniendo progresivamente
  mas información sobre el edificio. Este componente tiene el nombre
  de Componente de Ingreso Progresivo (\textit{Progressive Profile Widget} PPW).
  Esta ruta es documentada en el caso de uso \textit{Obtener información
  del edificio}
\end{itemize}

\begin{usecase}
  \addtitle{Caso de Uso:}{Administrar perfil del edificio.}
  \addfield{Descripción:}{En una sola pantalla se proporciona acceso
    al usuario de todas las preguntas y respuestas asociadas a las
    características básicas, detalladas y opcionales de un edificio.}
  \addfield{Actor:}{Cliente PyME}
  \additemizedfield{Precondiciones:}{
  \item El usuario a sido autentificado por medio de un token SSO (Single Sign On)
    asignado por el sistema de PG\&E.
  \item El usuario a creado previamente el perfil básico del edificio.
  }
  \addscenario{Flujo normal:}{
  \item El sistema checa si la cuenta tiene mas de un edificio asociado.
    \begin{itemize}
    \item Si hay mas de un edificio asociado a la cuenta el usuario
      tiene que seleccionar el edificio correspondiente.
    \end{itemize}
  \item El sistema despliega una lista de preguntas y respuestas divida en secciones.
    Las secciones completadas están marcadas con una marca de completado.
    \begin{itemize}
    \item Las secciones que se despliegan dependen del tipo de edificio,
      por ejemplo: construcción, iluminación, calefacción y refrigeración.
    \end{itemize}
  \item El usuario selecciona una sección, esta se expande para mostrar todas
    las preguntas de la sección.
  \item El usuario responde una o varias preguntas.
    \begin{enumerate}
    \item Las preguntas son ordenadas dentro de cada sección según un orden
      predefinido. Las secciones también tienen un orden predefinido.
    \item Según vaya respondiendo preguntas el usuario se va actualizando
      un indicador de completes del perfil.
    \end{enumerate}
  \item El usuario selecciona seguir con la siguiente sección o da click al
    encabezado de otra sección.
  \item El sistema persiste la información en cuanto el usuario selecciona
    una respuesta. Al obtener nueva información el sistema debe recalcular
    las recomendaciones asociadas al edificio.
  }
  \addfield{Postcondiciones:}{
    Un perfil del edificio mas detallado si el usuario dio respuesta a una pregunta
    sin contestar sobre su edificio.
  }
\end{usecase}

\section{Interfase de usuario}
Dentro de los requerimientos del proyecto PEAT se tenia la implementación de una
interfaz de usuario que fuera lo suficientemente eficaz y sencilla, para así obtener
la mayor cantidad de información del usuario.

\subsection{Crear perfil del edificio}

Los datos de facturación del consumo energético, electricidad o gas, de la cuenta
de un usuario no son suficientes para poder obtener de forma automática datos
importantes como el numero de edificios y sus características básicas.
Los métodos existentes no son fiables y por lo tanto es necesario que el usuario
responda a una seria de preguntas para definir las características básicas
de sus edificios.

